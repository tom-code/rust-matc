//! Generated Matter TLV encoders and decoders for Smoke CO Alarm Cluster
//! Cluster ID: 0x005C
//!
//! This file is automatically generated from SmokeCOAlarm.xml

use crate::tlv;
use anyhow;
use serde_json;


// Enum definitions

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum AlarmState {
    /// Nominal state, the device is not alarming
    Normal = 0,
    /// Warning state
    Warning = 1,
    /// Critical state
    Critical = 2,
}

impl AlarmState {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(AlarmState::Normal),
            1 => Some(AlarmState::Warning),
            2 => Some(AlarmState::Critical),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<AlarmState> for u8 {
    fn from(val: AlarmState) -> Self {
        val as u8
    }
}

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum ContaminationState {
    /// Nominal state, the sensor is not contaminated
    Normal = 0,
    /// Low contamination
    Low = 1,
    /// Warning state
    Warning = 2,
    /// Critical state, will cause nuisance alarms
    Critical = 3,
}

impl ContaminationState {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(ContaminationState::Normal),
            1 => Some(ContaminationState::Low),
            2 => Some(ContaminationState::Warning),
            3 => Some(ContaminationState::Critical),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<ContaminationState> for u8 {
    fn from(val: ContaminationState) -> Self {
        val as u8
    }
}

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum EndOfService {
    /// Device has not expired
    Normal = 0,
    /// Device has reached its end of service
    Expired = 1,
}

impl EndOfService {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(EndOfService::Normal),
            1 => Some(EndOfService::Expired),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<EndOfService> for u8 {
    fn from(val: EndOfService) -> Self {
        val as u8
    }
}

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum ExpressedState {
    /// Nominal state, the device is not alarming
    Normal = 0,
    /// Smoke Alarm state
    Smokealarm = 1,
    /// CO Alarm state
    Coalarm = 2,
    /// Battery Alert State
    Batteryalert = 3,
    /// Test in Progress
    Testing = 4,
    /// Hardware Fault Alert State
    Hardwarefault = 5,
    /// End of Service Alert State
    Endofservice = 6,
    /// Interconnected Smoke Alarm State
    Interconnectsmoke = 7,
    /// Interconnected CO Alarm State
    Interconnectco = 8,
}

impl ExpressedState {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(ExpressedState::Normal),
            1 => Some(ExpressedState::Smokealarm),
            2 => Some(ExpressedState::Coalarm),
            3 => Some(ExpressedState::Batteryalert),
            4 => Some(ExpressedState::Testing),
            5 => Some(ExpressedState::Hardwarefault),
            6 => Some(ExpressedState::Endofservice),
            7 => Some(ExpressedState::Interconnectsmoke),
            8 => Some(ExpressedState::Interconnectco),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<ExpressedState> for u8 {
    fn from(val: ExpressedState) -> Self {
        val as u8
    }
}

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum MuteState {
    /// Not Muted
    Notmuted = 0,
    /// Muted
    Muted = 1,
}

impl MuteState {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(MuteState::Notmuted),
            1 => Some(MuteState::Muted),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<MuteState> for u8 {
    fn from(val: MuteState) -> Self {
        val as u8
    }
}

#[derive(Debug, Clone, Copy, PartialEq, Eq, serde::Serialize, serde::Deserialize)]
#[repr(u8)]
pub enum Sensitivity {
    /// High sensitivity
    High = 0,
    /// Standard Sensitivity
    Standard = 1,
    /// Low sensitivity
    Low = 2,
}

impl Sensitivity {
    /// Convert from u8 value
    pub fn from_u8(value: u8) -> Option<Self> {
        match value {
            0 => Some(Sensitivity::High),
            1 => Some(Sensitivity::Standard),
            2 => Some(Sensitivity::Low),
            _ => None,
        }
    }

    /// Convert to u8 value
    pub fn to_u8(self) -> u8 {
        self as u8
    }
}

impl From<Sensitivity> for u8 {
    fn from(val: Sensitivity) -> Self {
        val as u8
    }
}

// Command encoders

// Attribute decoders

/// Decode ExpressedState attribute (0x0000)
pub fn decode_expressed_state(inp: &tlv::TlvItemValue) -> anyhow::Result<ExpressedState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        ExpressedState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode SmokeState attribute (0x0001)
pub fn decode_smoke_state(inp: &tlv::TlvItemValue) -> anyhow::Result<AlarmState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        AlarmState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode COState attribute (0x0002)
pub fn decode_co_state(inp: &tlv::TlvItemValue) -> anyhow::Result<AlarmState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        AlarmState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode BatteryAlert attribute (0x0003)
pub fn decode_battery_alert(inp: &tlv::TlvItemValue) -> anyhow::Result<AlarmState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        AlarmState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode DeviceMuted attribute (0x0004)
pub fn decode_device_muted(inp: &tlv::TlvItemValue) -> anyhow::Result<MuteState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        MuteState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode TestInProgress attribute (0x0005)
pub fn decode_test_in_progress(inp: &tlv::TlvItemValue) -> anyhow::Result<bool> {
    if let tlv::TlvItemValue::Bool(v) = inp {
        Ok(*v)
    } else {
        Err(anyhow::anyhow!("Expected Bool"))
    }
}

/// Decode HardwareFaultAlert attribute (0x0006)
pub fn decode_hardware_fault_alert(inp: &tlv::TlvItemValue) -> anyhow::Result<bool> {
    if let tlv::TlvItemValue::Bool(v) = inp {
        Ok(*v)
    } else {
        Err(anyhow::anyhow!("Expected Bool"))
    }
}

/// Decode EndOfServiceAlert attribute (0x0007)
pub fn decode_end_of_service_alert(inp: &tlv::TlvItemValue) -> anyhow::Result<EndOfService> {
    if let tlv::TlvItemValue::Int(v) = inp {
        EndOfService::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode InterconnectSmokeAlarm attribute (0x0008)
pub fn decode_interconnect_smoke_alarm(inp: &tlv::TlvItemValue) -> anyhow::Result<AlarmState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        AlarmState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode InterconnectCOAlarm attribute (0x0009)
pub fn decode_interconnect_co_alarm(inp: &tlv::TlvItemValue) -> anyhow::Result<AlarmState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        AlarmState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode ContaminationState attribute (0x000A)
pub fn decode_contamination_state(inp: &tlv::TlvItemValue) -> anyhow::Result<ContaminationState> {
    if let tlv::TlvItemValue::Int(v) = inp {
        ContaminationState::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode SmokeSensitivityLevel attribute (0x000B)
pub fn decode_smoke_sensitivity_level(inp: &tlv::TlvItemValue) -> anyhow::Result<Sensitivity> {
    if let tlv::TlvItemValue::Int(v) = inp {
        Sensitivity::from_u8(*v as u8).ok_or_else(|| anyhow::anyhow!("Invalid enum value"))
    } else {
        Err(anyhow::anyhow!("Expected Integer"))
    }
}

/// Decode ExpiryDate attribute (0x000C)
pub fn decode_expiry_date(inp: &tlv::TlvItemValue) -> anyhow::Result<u64> {
    if let tlv::TlvItemValue::Int(v) = inp {
        Ok(*v)
    } else {
        Err(anyhow::anyhow!("Expected UInt64"))
    }
}


// JSON dispatcher function

/// Decode attribute value and return as JSON string
/// 
/// # Parameters
/// * `cluster_id` - The cluster identifier
/// * `attribute_id` - The attribute identifier
/// * `tlv_value` - The TLV value to decode
/// 
/// # Returns
/// JSON string representation of the decoded value or error
pub fn decode_attribute_json(cluster_id: u32, attribute_id: u32, tlv_value: &crate::tlv::TlvItemValue) -> String {
    // Verify this is the correct cluster
    if cluster_id != 0x005C {
        return format!("{{\"error\": \"Invalid cluster ID. Expected 0x005C, got {}\"}}", cluster_id);
    }
    
    match attribute_id {
        0x0000 => {
            match decode_expressed_state(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0001 => {
            match decode_smoke_state(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0002 => {
            match decode_co_state(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0003 => {
            match decode_battery_alert(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0004 => {
            match decode_device_muted(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0005 => {
            match decode_test_in_progress(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0006 => {
            match decode_hardware_fault_alert(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0007 => {
            match decode_end_of_service_alert(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0008 => {
            match decode_interconnect_smoke_alarm(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x0009 => {
            match decode_interconnect_co_alarm(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x000A => {
            match decode_contamination_state(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x000B => {
            match decode_smoke_sensitivity_level(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        0x000C => {
            match decode_expiry_date(tlv_value) {
                Ok(value) => serde_json::to_string(&value).unwrap_or_else(|_| "null".to_string()),
                Err(e) => format!("{{\"error\": \"{}\"}}", e),
            }
        }
        _ => format!("{{\"error\": \"Unknown attribute ID: {}\"}}", attribute_id),
    }
}

/// Get list of all attributes supported by this cluster
/// 
/// # Returns
/// Vector of tuples containing (attribute_id, attribute_name)
pub fn get_attribute_list() -> Vec<(u32, &'static str)> {
    vec![
        (0x0000, "ExpressedState"),
        (0x0001, "SmokeState"),
        (0x0002, "COState"),
        (0x0003, "BatteryAlert"),
        (0x0004, "DeviceMuted"),
        (0x0005, "TestInProgress"),
        (0x0006, "HardwareFaultAlert"),
        (0x0007, "EndOfServiceAlert"),
        (0x0008, "InterconnectSmokeAlarm"),
        (0x0009, "InterconnectCOAlarm"),
        (0x000A, "ContaminationState"),
        (0x000B, "SmokeSensitivityLevel"),
        (0x000C, "ExpiryDate"),
    ]
}

